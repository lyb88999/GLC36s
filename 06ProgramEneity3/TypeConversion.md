# 题目：类型转换规则

## 知识点 1：类型转换表达式的基本写法

类型转换表达式的基本写法是 `T(x)`，其中的 `x` 可以是一个变量，也可以是一个代表值的字面量（比如 `1.23` 和 `struct{}{}`），还可以是一个表达式。

## 知识点 2：整数类型值和整数常量之间的类型转换

_对于整数类型值、整数常量之间的类型转换，原则上只要源值在目标类型的可表示范围之内就是合法的。_

比如，之所以`uint8(255)`可以把无类型常量`255`转换为`uint8`类型的值，是因为`255`在`[0,255]`的范围之内

但需要特别注意的是，源整数类型的可表示范围较大，而目标类型的可表示范围较小的情况，比如把值的类型从`int16`转为`int8`:

```go
var srcInt = int16(-255)
dstInt := int8(srcInt)
```

变量 srcInt 的值是`int16`类型的`-255`，而变量`dstInt`的值是由前者转换而来的，类型是`int8`
`int16`类型的可表示范围可比`int8`类型大了不少，那`distInt`的值是多少呢

首先你要知道，整数在 Go 语言以及计算机中都是以补码的形式存储的。这主要是为了简化计算机对整数的运算过程。负数的补码就是原码各位取反再加 1，正数的补码就是原码。

比如，`int16`类型的值`-255`的补码是`1111111100000001`，如果我们把这个值转换为`int8`类型的值，那么 Go 语言会把在较高位置(左边位置)上的 8 位二进制数截掉，从而得到`00000001`

又因为最左边一位是 0，表示它是个正整数，以及正整数的补码就是它的原码，所以`distInt`的值就是 1

_一定要记住，当整数值的类型的有效范围由宽变窄时，只需在补码形式下截掉一定数量的高位二进制数即可。_

_类似的快刀斩乱麻规则还有：当把一个浮点数类型的值转换为整数类型值时，前者的小数部分会被全部截掉。_

## 知识点 3：整数值转换为 string 类型

虽然直接把一个整数值转换为一个 `string` 类型是可行的，但值得关注的是，被转换的整数值应该可以代表一个有效的 Unicode 码点，否则转换的结果将会是 "�"。

字符'�'的 Unicode 代码点是 U+FFFD。它是 Unicode 标准中定义的 Replacement Character，专用于替换那些未知的、不被认可的以及无法展示的字符。

```go
string(-1)
```

由于`-1`肯定无法代表一个有效的 Unicode 代码点，所以得到的总会是"�"

## 知识点 4：string 类型与各种切片类型之间的互转

_一个值在从 string 类型向[]byte 类型转换时代表着以 UTF-8 编码的字符串会被拆分为零散、独立的字节。_

_除了与 ASCII 编码兼容的那部分字符集，以 UTF-8 编码的某个单一字节是无法代表一个字符的。_

```go
string([]byte{'\xe4', '\xbd', '\xa0', '\xe5', '\xa5', '\xbd'}) // 你好
```

UTF-8 编码的三个字节`'\xe4'`,`'\xbd'`,`'\xa0'`合在一起代表汉字的`你`,而`\xe5`、`\xa5`和`\xbd`合在一起才能代表字符`'好'`。

其次，一个值在从 string 类型向[]rune 类型转换时代表着字符串会被拆分成一个个 Unicode 字符。

```go
string([]rune{'\u4F60', '\u597D'}) // 你好
```
